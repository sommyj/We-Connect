{"version":3,"sources":["reviews.js"],"names":["Object","defineProperty","exports","value","_models","require","_models2","_interopRequireDefault","obj","__esModule","default","_ref","Review","reviewsController","create","req","res","body","response","userId","businessId","status","send","message","params","then","review","catch","error","list","findAll","where","reviews","update","findById","reviewId","reviewUpdate","destroy"],"mappings":"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","file":"reviews.js","sourceRoot":"/home/somto/Andela/We-Connect/lib/server/controllers","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _models = require('../models');\n\nvar _models2 = _interopRequireDefault(_models);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _ref = [_models2.default.Review],\n    Review = _ref[0];\n\n\nvar reviewsController = {\n  create: function create(req, res) {\n    if (!req.body.response || !req.body.userId || !req.body.businessId) {\n      return res.status(206).send({ message: 'Incomplete field' });\n    }\n\n    return Review.create({\n      response: req.body.response,\n      userId: req.body.userId,\n      businessId: req.params.businessId\n    }).then(function (review) {\n      return res.status(201).send(review);\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  },\n  list: function list(req, res) {\n    return Review.findAll({ where: { businessId: req.params.businessId } }).then(function (reviews) {\n      return res.status(200).send(reviews);\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  },\n  update: function update(req, res) {\n    return Review.findById(req.params.reviewId).then(function (review) {\n      if (!review) {\n        return res.status(404).send({ message: 'Review not found' });\n      }\n      if (review.userId !== req.body.userId) {\n        return res.status(400).send({ message: 'User can not be altered' });\n      }\n      if (review.businessId !== req.body.businessId) {\n        return res.status(400).send({ message: 'Business can not be altered' });\n      }\n      return review.update({\n        response: req.body.response || review.response,\n        userId: req.body.userId || review.userId,\n        businessId: req.params.businessId\n      }).then(function (reviewUpdate) {\n        return res.status(200).send(reviewUpdate);\n      }).catch(function (error) {\n        return res.status(400).send(error);\n      });\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  },\n  destroy: function destroy(req, res) {\n    return Review.findById(req.params.reviewId).then(function (review) {\n      if (!review) {\n        return res.status(404).send({ message: 'Review not found' });\n      }\n      return review.destroy().then(function () {\n        return res.status(204).send();\n      }).catch(function (error) {\n        return res.status(400).send(error);\n      });\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  }\n};\n\nexports.default = reviewsController;"]}