{"version":3,"sources":["users.js"],"names":["Object","defineProperty","exports","value","_multer","require","_multer2","_interopRequireDefault","_fileSystem","_fileSystem2","_jsonwebtoken","_jsonwebtoken2","_bcryptjs","_bcryptjs2","_models","_models2","obj","__esModule","default","_ref","User","Business","upload","dest","fileSizeLimit","renameFile","tempPath","targetPath","rename","err","deleteFile","unlink","fileTypeHandleError","res","status","json","message","error","fileSizeHandleError","usersController","single","create","req","filePath","file","path","Date","toISOString","originalname","mimetype","size","substring","length","body","title","firstname","lastname","username","password","email","gender","dob","phone","send","hashedPassword","hashSync","street","city","state","country","userImage","then","user","catch","check","findOne","where","list","findAll","include","model","as","users","update","findById","params","userId","previousImage","userUpdate","destroy","retrieve"],"mappings":"AAAA;;AAEAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,SAAO;AADoC,CAA7C;;AAIA,IAAIC,UAAUC,QAAQ,QAAR,CAAd;;AAEA,IAAIC,WAAWC,uBAAuBH,OAAvB,CAAf;;AAEA,IAAII,cAAcH,QAAQ,aAAR,CAAlB;;AAEA,IAAII,eAAeF,uBAAuBC,WAAvB,CAAnB;;AAEA,IAAIE,gBAAgBL,QAAQ,cAAR,CAApB;;AAEA,IAAIM,iBAAiBJ,uBAAuBG,aAAvB,CAArB;;AAEA,IAAIE,YAAYP,QAAQ,UAAR,CAAhB;;AAEA,IAAIQ,aAAaN,uBAAuBK,SAAvB,CAAjB;;AAEA,IAAIE,UAAUT,QAAQ,WAAR,CAAd;;AAEA,IAAIU,WAAWR,uBAAuBO,OAAvB,CAAf;;AAEA,SAASP,sBAAT,CAAgCS,GAAhC,EAAqC;AAAE,SAAOA,OAAOA,IAAIC,UAAX,GAAwBD,GAAxB,GAA8B,EAAEE,SAASF,GAAX,EAArC;AAAwD;;AAE/F,IAAIG,OAAO,CAACJ,SAASG,OAAT,CAAiBE,IAAlB,EAAwBL,SAASG,OAAT,CAAiBG,QAAzC,CAAX;AAAA,IACID,OAAOD,KAAK,CAAL,CADX;AAAA,IAEIE,WAAWF,KAAK,CAAL,CAFf;;AAKA,IAAIG,SAAS,CAAC,GAAGhB,SAASY,OAAb,EAAsB;AACjCK,QAAM;AAD2B,CAAtB,CAAb;;AAIA,IAAIC,gBAAgB,OAAO,IAAP,GAAc,CAAlC;;AAEA;;;;;;AAMA,IAAIC,aAAa,SAASA,UAAT,CAAoBC,QAApB,EAA8BC,UAA9B,EAA0C;AACzDlB,eAAaS,OAAb,CAAqBU,MAArB,CAA4BF,QAA5B,EAAsCC,UAAtC,EAAkD,UAAUE,GAAV,EAAe;AAC/D,QAAIA,GAAJ,EAAS,MAAMA,GAAN;AACV,GAFD;AAGD,CAJD;;AAMA;;;;;AAKA,IAAIC,aAAa,SAASA,UAAT,CAAoBH,UAApB,EAAgC;AAC/ClB,eAAaS,OAAb,CAAqBa,MAArB,CAA4BJ,UAA5B,EAAwC,UAAUE,GAAV,EAAe;AACrD,QAAIA,GAAJ,EAAS,MAAMA,GAAN;AACV,GAFD;AAGD,CAJD;;AAMA;AACA,IAAIG,sBAAsB,SAASA,mBAAT,CAA6BC,GAA7B,EAAkC;AAC1DA,MAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,uCAAX,EAAoDC,OAAO,IAA3D,EAArB;AACD,CAFD;;AAIA;AACA,IAAIC,sBAAsB,SAASA,mBAAT,CAA6BL,GAA7B,EAAkC;AAC1DA,MAAIC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,mCAAX,EAAgDC,OAAO,IAAvD,EAArB;AACD,CAFD;;AAIA,IAAIE,kBAAkB;AACpB;AACAjB,UAAQA,OAAOkB,MAAP,CAAc,WAAd,CAFY;AAGpB;AACAC,UAAQ,SAASA,MAAT,CAAgBC,GAAhB,EAAqBT,GAArB,EAA0B;AAChC,QAAIU,WAAW,EAAf;AACA,QAAID,IAAIE,IAAR,EAAc;AACZ,UAAIlB,WAAW,OAAOgB,IAAIE,IAAJ,CAASC,IAA/B;AACA,UAAIlB,aAAa,qBAAqB,IAAImB,IAAJ,GAAWC,WAAX,KAA2BL,IAAIE,IAAJ,CAASI,YAAzD,CAAjB;AACA,UAAIN,IAAIE,IAAJ,CAASK,QAAT,KAAsB,YAAtB,IAAsCP,IAAIE,IAAJ,CAASK,QAAT,KAAsB,WAAhE,EAA6E;AAC3E,YAAIP,IAAIE,IAAJ,CAASM,IAAT,IAAiB1B,aAArB,EAAoC;AAClCC,qBAAWC,QAAX,EAAqBC,UAArB;AACD,SAFD,MAEO;AACLG,qBAAWJ,QAAX;AACA,iBAAOY,oBAAoBL,GAApB,CAAP;AACD;AACF,OAPD,MAOO;AACLH,mBAAWJ,QAAX;AACA,eAAOM,oBAAoBC,GAApB,CAAP;AACD;AACD;AACAU,iBAAWhB,WAAWwB,SAAX,CAAqB,CAArB,EAAwBxB,WAAWyB,MAAnC,CAAX;AACD;;AAED,QAAI,CAACV,IAAIW,IAAJ,CAASC,KAAV,IAAmB,CAACZ,IAAIW,IAAJ,CAASE,SAA7B,IAA0C,CAACb,IAAIW,IAAJ,CAASG,QAApD,IAAgE,CAACd,IAAIW,IAAJ,CAASI,QAA1E,IAAsF,CAACf,IAAIW,IAAJ,CAASK,QAAhG,IAA4G,CAAChB,IAAIW,IAAJ,CAASM,KAAtH,IAA+H,CAACjB,IAAIW,IAAJ,CAASO,MAAzI,IAAmJ,CAAClB,IAAIW,IAAJ,CAASQ,GAA7J,IAAoK,CAACnB,IAAIW,IAAJ,CAASS,KAAlL,EAAyL;AACvL,UAAInB,QAAJ,EAAc;AACZb,mBAAW,OAAOa,QAAlB;AACD;AACD,aAAOV,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB,EAAE3B,SAAS,kBAAX,EAArB,CAAP;AACD;;AAED,QAAI4B,iBAAiBnD,WAAWK,OAAX,CAAmB+C,QAAnB,CAA4BvB,IAAIW,IAAJ,CAASK,QAArC,EAA+C,CAA/C,CAArB;;AAEA,WAAOtC,KAAKqB,MAAL,CAAY;AACjBa,aAAOZ,IAAIW,IAAJ,CAASC,KADC,EACMC,WAAWb,IAAIW,IAAJ,CAASE,SAD1B,EACqCC,UAAUd,IAAIW,IAAJ,CAASG,QADxD;AAEjBC,gBAAUf,IAAIW,IAAJ,CAASI,QAFF,EAEYC,UAAUM,cAFtB,EAEsCL,OAAOjB,IAAIW,IAAJ,CAASM,KAFtD;AAGjBC,cAAQlB,IAAIW,IAAJ,CAASO,MAHA,EAGQM,QAAQxB,IAAIW,IAAJ,CAASa,MAHzB,EAGiCC,MAAMzB,IAAIW,IAAJ,CAASc,IAHhD;AAIjBC,aAAO1B,IAAIW,IAAJ,CAASe,KAJC,EAIMC,SAAS3B,IAAIW,IAAJ,CAASgB,OAJxB,EAIiCR,KAAKnB,IAAIW,IAAJ,CAASQ,GAJ/C;AAKjBC,aAAOpB,IAAIW,IAAJ,CAASS,KALC,EAKMQ,WAAW3B;AALjB,KAAZ,EAMJ4B,IANI,CAMC,UAAUC,IAAV,EAAgB;AACtB;AACA;AACA;AACA;AACA;AACAvC,UAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqBS,IAArB;AACD,KAbM,EAaJC,KAbI,CAaE,UAAUpC,KAAV,EAAiB;AACxB,UAAIM,QAAJ,EAAc;AACZb,mBAAW,OAAOa,QAAlB;AACD;AACD,aAAOV,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,KAlBM,CAAP;AAmBD,GApDmB;;AAsDpB;AACAqC,SAAO,SAASA,KAAT,CAAehC,GAAf,EAAoBT,GAApB,EAAyB;AAC9B,WAAOb,KAAKuD,OAAL,CAAa,EAAEC,OAAO,EAAEnB,UAAUf,IAAIW,IAAJ,CAASI,QAArB,EAA+BC,UAAUhB,IAAIW,IAAJ,CAASK,QAAlD,EAAT,EAAb,EAAsFa,IAAtF,CAA2F,UAAUC,IAAV,EAAgB;AAChH,UAAI,CAACA,IAAL,EAAW;AACT,eAAOvC,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB,EAAE3B,SAAS,gBAAX,EAArB,CAAP;AACD;AACD,aAAOH,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqBS,IAArB,CAAP;AACD,KALM,EAKJC,KALI,CAKE,UAAUpC,KAAV,EAAiB;AACxB,aAAOJ,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,KAPM,CAAP;AAQD,GAhEmB;AAiEpBwC,QAAM,SAASA,IAAT,CAAcnC,GAAd,EAAmBT,GAAnB,EAAwB;AAC5B,WAAOb,KAAK0D,OAAL,CAAa;AAClBC,eAAS,CAAC;AACRC,eAAO3D,QADC;AAER4D,YAAI;AAFI,OAAD;AADS,KAAb,EAKJV,IALI,CAKC,UAAUW,KAAV,EAAiB;AACvB,aAAOjD,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqBmB,KAArB,CAAP;AACD,KAPM,EAOJT,KAPI,CAOE,UAAUpC,KAAV,EAAiB;AACxB,aAAOJ,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,KATM,CAAP;AAUD,GA5EmB;;AA8EpB;AACA8C,UAAQ,SAASA,MAAT,CAAgBzC,GAAhB,EAAqBT,GAArB,EAA0B;AAChC,QAAIU,WAAW,EAAf;AACA,QAAID,IAAIE,IAAR,EAAc;AACZ,UAAIlB,WAAW,OAAOgB,IAAIE,IAAJ,CAASC,IAA/B;AACA,UAAIlB,aAAa,qBAAqB,IAAImB,IAAJ,GAAWC,WAAX,KAA2BL,IAAIE,IAAJ,CAASI,YAAzD,CAAjB;;AAEA,UAAIN,IAAIE,IAAJ,CAASK,QAAT,KAAsB,YAAtB,IAAsCP,IAAIE,IAAJ,CAASK,QAAT,KAAsB,WAAhE,EAA6E;AAC3E,YAAIP,IAAIE,IAAJ,CAASM,IAAT,IAAiB1B,aAArB,EAAoC;AAClCC,qBAAWC,QAAX,EAAqBC,UAArB;AACA;AACAgB,qBAAWhB,WAAWwB,SAAX,CAAqB,CAArB,EAAwBxB,WAAWyB,MAAnC,CAAX;AACD,SAJD,MAIO;AACLtB,qBAAWJ,QAAX;AACA,iBAAOY,oBAAoBL,GAApB,CAAP;AACD;AACF,OATD,MASO;AACLH,mBAAWJ,QAAX;AACA,eAAOM,oBAAoBC,GAApB,CAAP;AACD;AACF;;AAED,WAAOb,KAAKgE,QAAL,CAAc1C,IAAI2C,MAAJ,CAAWC,MAAzB,EAAiC;AACtCP,eAAS,CAAC;AACRC,eAAO3D,QADC;AAER4D,YAAI;AAFI,OAAD;AAD6B,KAAjC,EAKJV,IALI,CAKC,UAAUC,IAAV,EAAgB;AACtB,UAAI,CAACA,IAAL,EAAW;AACT;AACA,YAAI7B,QAAJ,EAAc;AACZb,qBAAW,OAAOa,QAAlB;AACD;AACD,eAAOV,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB,EAAE3B,SAAS,gBAAX,EAArB,CAAP;AACD;AACD;AACA,UAAImD,gBAAgBf,KAAKF,SAAzB;AACA,aAAOE,KAAKW,MAAL,CAAY;AACjB7B,eAAOZ,IAAIW,IAAJ,CAASC,KAAT,IAAkBkB,KAAKlB,KADb,EACoBC,WAAWb,IAAIW,IAAJ,CAASE,SAAT,IAAsBiB,KAAKjB,SAD1D;AAEjBC,kBAAUd,IAAIW,IAAJ,CAASG,QAAT,IAAqBgB,KAAKhB,QAFnB,EAE6BC,UAAUf,IAAIW,IAAJ,CAASI,QAAT,IAAqBe,KAAKf,QAFjE;AAGjBC,kBAAUhB,IAAIW,IAAJ,CAASK,QAAT,IAAqBc,KAAKd,QAHnB,EAG6BC,OAAOjB,IAAIW,IAAJ,CAASM,KAAT,IAAkBa,KAAKb,KAH3D;AAIjBC,gBAAQlB,IAAIW,IAAJ,CAASO,MAAT,IAAmBY,KAAKZ,MAJf,EAIuBM,QAAQxB,IAAIW,IAAJ,CAASa,MAAT,IAAmBM,KAAKN,MAJvD;AAKjBC,cAAMzB,IAAIW,IAAJ,CAASc,IAAT,IAAiBK,KAAKL,IALX,EAKiBC,OAAO1B,IAAIW,IAAJ,CAASe,KAAT,IAAkBI,KAAKJ,KAL/C;AAMjBC,iBAAS3B,IAAIW,IAAJ,CAASgB,OAAT,IAAoBG,KAAKH,OANjB,EAM0BR,KAAKnB,IAAIW,IAAJ,CAASQ,GAAT,IAAgBW,KAAKX,GANpD;AAOjBC,eAAOpB,IAAIW,IAAJ,CAASS,KAAT,IAAkBU,KAAKV,KAPb,EAOoBQ,WAAW3B,YAAY6B,KAAKF;AAPhD,OAAZ,EAQJC,IARI,CAQC,UAAUiB,UAAV,EAAsB;AAC5B;AACA,YAAI7C,QAAJ,EAAc;AACZ,cAAI4C,aAAJ,EAAmB;AACjBzD,uBAAW,OAAOyD,aAAlB;AACD;AACF;AACD,eAAOtD,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqByB,UAArB,CAAP;AACD,OAhBM,EAgBJ;AAhBI,OAiBNf,KAjBM,CAiBA,UAAUpC,KAAV,EAAiB;AACtB,YAAIM,QAAJ,EAAc;AACZb,qBAAW,OAAOa,QAAlB;AACD;AACD,eAAOV,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,OAtBM,CAAP;AAuBD,KAtCM,EAsCJoC,KAtCI,CAsCE,UAAUpC,KAAV,EAAiB;AACxB,aAAOJ,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,KAxCM,CAAP;AAyCD,GA7ImB;;AA+IpB;AACAoD,WAAS,SAASA,OAAT,CAAiB/C,GAAjB,EAAsBT,GAAtB,EAA2B;AAClC,WAAOb,KAAKgE,QAAL,CAAc1C,IAAI2C,MAAJ,CAAWC,MAAzB,EAAiCf,IAAjC,CAAsC,UAAUC,IAAV,EAAgB;AAC3D,UAAI,CAACA,IAAL,EAAW;AACT,eAAOvC,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB,EAAE3B,SAAS,gBAAX,EAArB,CAAP;AACD;;AAED,aAAOoC,KAAKiB,OAAL,GAAelB,IAAf,CAAoB,YAAY;AACrC,YAAIC,KAAKF,SAAT,EAAoB;AAClBxC,qBAAW,OAAO0C,KAAKF,SAAvB;AACD;AACD,eAAOrC,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,EAAP;AACD,OALM,EAKJU,KALI,CAKE,UAAUpC,KAAV,EAAiB;AACxB,eAAOJ,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,OAPM,CAAP;AAQD,KAbM,EAaJoC,KAbI,CAaE,UAAUpC,KAAV,EAAiB;AACxB,aAAOJ,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,KAfM,CAAP;AAgBD,GAjKmB;;AAmKpB;AACAqD,YAAU,SAASA,QAAT,CAAkBhD,GAAlB,EAAuBT,GAAvB,EAA4B;AACpC,WAAOb,KAAKgE,QAAL,CAAc1C,IAAI2C,MAAJ,CAAWC,MAAzB,EAAiC;AACtCP,eAAS,CAAC;AACRC,eAAO3D,QADC;AAER4D,YAAI;AAFI,OAAD;AAD6B,KAAjC,EAKJV,IALI,CAKC,UAAUC,IAAV,EAAgB;AACtB,UAAI,CAACA,IAAL,EAAW;AACT,eAAOvC,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB,EAAE3B,SAAS,gBAAX,EAArB,CAAP;AACD;AACD,aAAOH,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqBS,IAArB,CAAP;AACD,KAVM,EAUJC,KAVI,CAUE,UAAUpC,KAAV,EAAiB;AACxB,aAAOJ,IAAIC,MAAJ,CAAW,GAAX,EAAgB6B,IAAhB,CAAqB1B,KAArB,CAAP;AACD,KAZM,CAAP;AAaD;AAlLmB,CAAtB;;AAqLAnC,QAAQgB,OAAR,GAAkBqB,eAAlB","file":"users.js","sourceRoot":"/home/somto/Andela/We-Connect/lib/server/controllers","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _multer = require('multer');\n\nvar _multer2 = _interopRequireDefault(_multer);\n\nvar _fileSystem = require('file-system');\n\nvar _fileSystem2 = _interopRequireDefault(_fileSystem);\n\nvar _jsonwebtoken = require('jsonwebtoken');\n\nvar _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);\n\nvar _bcryptjs = require('bcryptjs');\n\nvar _bcryptjs2 = _interopRequireDefault(_bcryptjs);\n\nvar _models = require('../models');\n\nvar _models2 = _interopRequireDefault(_models);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _ref = [_models2.default.User, _models2.default.Business],\n    User = _ref[0],\n    Business = _ref[1];\n\n\nvar upload = (0, _multer2.default)({\n  dest: './usersUploads/'\n});\n\nvar fileSizeLimit = 1024 * 1024 * 2;\n\n/**\n * rename file to an appropriate name\n * @param {String} tempPath The temporary path name.\n * @param {String} targetPath The target path name.\n * @returns {void} nothing.\n */\nvar renameFile = function renameFile(tempPath, targetPath) {\n  _fileSystem2.default.rename(tempPath, targetPath, function (err) {\n    if (err) throw err;\n  });\n};\n\n/**\n * delete a file\n * @param {String} targetPath The part to delete from\n * @returns {void} nothing.\n */\nvar deleteFile = function deleteFile(targetPath) {\n  _fileSystem2.default.unlink(targetPath, function (err) {\n    if (err) throw err;\n  });\n};\n\n// file type handleError\nvar fileTypeHandleError = function fileTypeHandleError(res) {\n  res.status(403).json({ message: 'Only .png and .jpg files are allowed!', error: true });\n};\n\n// file size handleError\nvar fileSizeHandleError = function fileSizeHandleError(res) {\n  res.status(403).json({ message: 'file should not be more than 2mb!', error: true });\n};\n\nvar usersController = {\n  // image upload\n  upload: upload.single('userImage'),\n  // create a user\n  create: function create(req, res) {\n    var filePath = '';\n    if (req.file) {\n      var tempPath = './' + req.file.path;\n      var targetPath = './usersUploads/' + (new Date().toISOString() + req.file.originalname);\n      if (req.file.mimetype === 'image/jpeg' || req.file.mimetype === 'image/png') {\n        if (req.file.size <= fileSizeLimit) {\n          renameFile(tempPath, targetPath);\n        } else {\n          deleteFile(tempPath);\n          return fileSizeHandleError(res);\n        }\n      } else {\n        deleteFile(tempPath);\n        return fileTypeHandleError(res);\n      }\n      // remove the dot in targetPath\n      filePath = targetPath.substring(1, targetPath.length);\n    }\n\n    if (!req.body.title || !req.body.firstname || !req.body.lastname || !req.body.username || !req.body.password || !req.body.email || !req.body.gender || !req.body.dob || !req.body.phone) {\n      if (filePath) {\n        deleteFile('./' + filePath);\n      }\n      return res.status(206).send({ message: 'Incomplete field' });\n    }\n\n    var hashedPassword = _bcryptjs2.default.hashSync(req.body.password, 8);\n\n    return User.create({\n      title: req.body.title, firstname: req.body.firstname, lastname: req.body.lastname,\n      username: req.body.username, password: hashedPassword, email: req.body.email,\n      gender: req.body.gender, street: req.body.street, city: req.body.city,\n      state: req.body.state, country: req.body.country, dob: req.body.dob,\n      phone: req.body.phone, userImage: filePath\n    }).then(function (user) {\n      // console.log(app.get('superSecret'));\n      // const payload = { id: user.id };\n      //   const token = jwt.sign(payload, app.get('superSecret'),\n      //   { expiresIn: 86400 // expires in 24 hours\n      //   });\n      res.status(201).send(user);\n    }).catch(function (error) {\n      if (filePath) {\n        deleteFile('./' + filePath);\n      }\n      return res.status(400).send(error);\n    });\n  },\n\n  // login with username and password\n  check: function check(req, res) {\n    return User.findOne({ where: { username: req.body.username, password: req.body.password } }).then(function (user) {\n      if (!user) {\n        return res.status(404).send({ message: 'User not found' });\n      }\n      return res.status(200).send(user);\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  },\n  list: function list(req, res) {\n    return User.findAll({\n      include: [{\n        model: Business,\n        as: 'businesses'\n      }]\n    }).then(function (users) {\n      return res.status(200).send(users);\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  },\n\n  // update user\n  update: function update(req, res) {\n    var filePath = '';\n    if (req.file) {\n      var tempPath = './' + req.file.path;\n      var targetPath = './usersUploads/' + (new Date().toISOString() + req.file.originalname);\n\n      if (req.file.mimetype === 'image/jpeg' || req.file.mimetype === 'image/png') {\n        if (req.file.size <= fileSizeLimit) {\n          renameFile(tempPath, targetPath);\n          // remove the dot in targetPath\n          filePath = targetPath.substring(1, targetPath.length);\n        } else {\n          deleteFile(tempPath);\n          return fileSizeHandleError(res);\n        }\n      } else {\n        deleteFile(tempPath);\n        return fileTypeHandleError(res);\n      }\n    }\n\n    return User.findById(req.params.userId, {\n      include: [{\n        model: Business,\n        as: 'businesses'\n      }]\n    }).then(function (user) {\n      if (!user) {\n        // if file and url is not empty delete img for updation\n        if (filePath) {\n          deleteFile('./' + filePath);\n        }\n        return res.status(404).send({ message: 'User not found' });\n      }\n      // holds the url of the image before update in other not to loose it\n      var previousImage = user.userImage;\n      return user.update({\n        title: req.body.title || user.title, firstname: req.body.firstname || user.firstname,\n        lastname: req.body.lastname || user.lastname, username: req.body.username || user.username,\n        password: req.body.password || user.password, email: req.body.email || user.email,\n        gender: req.body.gender || user.gender, street: req.body.street || user.street,\n        city: req.body.city || user.city, state: req.body.state || user.state,\n        country: req.body.country || user.country, dob: req.body.dob || user.dob,\n        phone: req.body.phone || user.phone, userImage: filePath || user.userImage\n      }).then(function (userUpdate) {\n        // if file and url is not empty delete img for updation\n        if (filePath) {\n          if (previousImage) {\n            deleteFile('./' + previousImage);\n          }\n        }\n        return res.status(200).send(userUpdate);\n      }) // Send back the updated user\n      .catch(function (error) {\n        if (filePath) {\n          deleteFile('./' + filePath);\n        }\n        return res.status(400).send(error);\n      });\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  },\n\n  // delete user\n  destroy: function destroy(req, res) {\n    return User.findById(req.params.userId).then(function (user) {\n      if (!user) {\n        return res.status(404).send({ message: 'User not found' });\n      }\n\n      return user.destroy().then(function () {\n        if (user.userImage) {\n          deleteFile('./' + user.userImage);\n        }\n        return res.status(204).send();\n      }).catch(function (error) {\n        return res.status(400).send(error);\n      });\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  },\n\n  // get a user\n  retrieve: function retrieve(req, res) {\n    return User.findById(req.params.userId, {\n      include: [{\n        model: Business,\n        as: 'businesses'\n      }]\n    }).then(function (user) {\n      if (!user) {\n        return res.status(404).send({ message: 'User not found' });\n      }\n      return res.status(200).send(user);\n    }).catch(function (error) {\n      return res.status(400).send(error);\n    });\n  }\n};\n\nexports.default = usersController;"]}